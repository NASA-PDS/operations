#!/usr/bin/env python
"""
Tool to generate simple markdown issue reports
"""
import argparse
import logging
import os
import subprocess
import sys

from github3 import login

DEFAULT_GITHUB_ORG = 'NASA-PDS'

# Quiet github3 logging
logger = logging.getLogger('github3')
logger.setLevel(level=logging.WARNING)

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

token = os.environ.get('GITHUB_TOKEN')
if not token:
    logger.error(f'Github token must be provided or set as environment variable (GITHUB_TOKEN).')
    sys.exit(1)

gh = login(token=token)
for _repo in gh.repositories_by(DEFAULT_GITHUB_ORG):
    print(f'{DEFAULT_GITHUB_ORG}/{_repo.name}')
    subprocess.run(['./update_issue_templates.sh', DEFAULT_GITHUB_ORG, _repo.name])
